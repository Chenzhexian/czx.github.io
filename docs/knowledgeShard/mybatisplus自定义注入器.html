<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <link rel="icon" href="https://czxcab.cn/file/myblog/me.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>mybatisplus自定义注入器 | czx的笔记</title><meta name="description" content="爱看不看不看拉倒">
    <link rel="preload" href="/note/assets/style-CdkRw3og.css" as="style"><link rel="stylesheet" href="/note/assets/style-CdkRw3og.css">
    <link rel="modulepreload" href="/note/assets/app-BoIshBAq.js"><link rel="modulepreload" href="/note/assets/mybatisplus自定义注入器.html-DNOMQOnf.js">
    <link rel="prefetch" href="/note/assets/index.html-fwkUDJrD.js" as="script"><link rel="prefetch" href="/note/assets/Bean拷贝之MapStruct.html-Bzcr2HRL.js" as="script"><link rel="prefetch" href="/note/assets/EasyExcel导出文件.html-z0vqobYY.js" as="script"><link rel="prefetch" href="/note/assets/Git 提交竟然还能这么用？.html-CVSQsiOX.js" as="script"><link rel="prefetch" href="/note/assets/LocalDateTime的使用.html-B-ffjWCZ.js" as="script"><link rel="prefetch" href="/note/assets/mysqlbinlog的使用.html-CHe9bZm8.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DC-ED_PP.js" as="script"><link rel="prefetch" href="/note/assets/SpringSecurity整合SAS.html-xmg6VJ0-.js" as="script"><link rel="prefetch" href="/note/assets/一篇搞定maven.html-0Ietw14c.js" as="script"><link rel="prefetch" href="/note/assets/后端如何编写单元测试？.html-CCF4P-UM.js" as="script"><link rel="prefetch" href="/note/assets/数据库备份还原.html-z2OcIQ_k.js" as="script"><link rel="prefetch" href="/note/assets/设计模式及应用.html-s08Uxyqf.js" as="script"><link rel="prefetch" href="/note/assets/轻松搞定SQL调优.html-oWHVpjll.js" as="script"><link rel="prefetch" href="/note/assets/index.html-D-oN63xV.js" as="script"><link rel="prefetch" href="/note/assets/《MySQL是怎样运行的》.html-ZNDtNQXg.js" as="script"><link rel="prefetch" href="/note/assets/判断.html-CwEffrx2.js" as="script"><link rel="prefetch" href="/note/assets/中共党史.html-CRHtP7y-.js" as="script"><link rel="prefetch" href="/note/assets/公务员法.html-v67e_p8W.js" as="script"><link rel="prefetch" href="/note/assets/公文知识.html-vNt_qV3u.js" as="script"><link rel="prefetch" href="/note/assets/刑法.html-D0rx7xKR.js" as="script"><link rel="prefetch" href="/note/assets/哲学.html-C9aeFfiP.js" as="script"><link rel="prefetch" href="/note/assets/宪法.html-Pb_tbNHH.js" as="script"><link rel="prefetch" href="/note/assets/民法.html-iwNfUSU5.js" as="script"><link rel="prefetch" href="/note/assets/经济.html-C95SgOiV.js" as="script"><link rel="prefetch" href="/note/assets/行政法.html-VCSj4AOg.js" as="script"><link rel="prefetch" href="/note/assets/IDEA常用技巧.html-Bb87V3ZK.js" as="script"><link rel="prefetch" href="/note/assets/linux常用命令.html-N8pQxTaE.js" as="script"><link rel="prefetch" href="/note/assets/log日志快速定位.html-Btq3p7Ch.js" as="script"><link rel="prefetch" href="/note/assets/Stream流式编程.html-8JR2a6aN.js" as="script"><link rel="prefetch" href="/note/assets/常用工具网站.html-B2nh3MW4.js" as="script"><link rel="prefetch" href="/note/assets/frp内网穿透.html-D7bU31ny.js" as="script"><link rel="prefetch" href="/note/assets/minio安装使用.html-B-dYBg6p.js" as="script"><link rel="prefetch" href="/note/assets/Windows系统后台运行服务.html-D8kK550a.js" as="script"><link rel="prefetch" href="/note/assets/yarn2.0_版本安装.html-D8pA6GlH.js" as="script"><link rel="prefetch" href="/note/assets/404.html-Ckti2_W_.js" as="script"><link rel="prefetch" href="/note/assets/style-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/note/assets/docsearch-l0sNRNKZ.js" as="script"><link rel="prefetch" href="/note/assets/index-Ds2TtRM5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/note/"><!----><span class="site-name" aria-hidden="true">czx的笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--[--><div id="chatbot-iframe" data-bot-src="https://www.czxcab.cn/chat/share?shareId=82doc068cwuhsgt3mbyiwjbu" data-default-open="false" data-drag="false" data-open-icon="data:image/svg+xml;base64,PHN2ZyB0PSIxNjkwNTMyNzg1NjY0IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxMzIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48cGF0aCBkPSJNNTEyIDMyQzI0Ny4wNCAzMiAzMiAyMjQgMzIgNDY0QTQxMC4yNCA0MTAuMjQgMCAwIDAgMTcyLjQ4IDc2OEwxNjAgOTY1LjEyYTI1LjI4IDI1LjI4IDAgMCAwIDM5LjA0IDIyLjRsMTY4LTExMkE1MjguNjQgNTI4LjY0IDAgMCAwIDUxMiA4OTZjMjY0Ljk2IDAgNDgwLTE5MiA0ODAtNDMyUzc3Ni45NiAzMiA1MTIgMzJ6IG0yNDQuOCA0MTZsLTM2MS42IDMwMS43NmExMi40OCAxMi40OCAwIDAgMS0xOS44NC0xMi40OGw1OS4yLTIzMy45MmgtMTYwYTEyLjQ4IDEyLjQ4IDAgMCAxLTcuMzYtMjMuMzZsMzYxLjYtMzAxLjc2YTEyLjQ4IDEyLjQ4IDAgMCAxIDE5Ljg0IDEyLjQ4bC01OS4yIDIzMy45MmgxNjBhMTIuNDggMTIuNDggMCAwIDEgOCAyMi4wOHoiIGZpbGw9IiM0ZTgzZmQiIHAtaWQ9IjQxMzMiPjwvcGF0aD48L3N2Zz4=" data-close-icon="data:image/svg+xml;base64,PHN2ZyB0PSIxNjkwNTM1NDQxNTI2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjYzNjciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj48cGF0aCBkPSJNNTEyIDEwMjRBNTEyIDUxMiAwIDEgMSA1MTIgMGE1MTIgNTEyIDAgMCAxIDAgMTAyNHpNMzA1Ljk1NjU3MSAzNzAuMzk1NDI5TDQ0Ny40ODggNTEyIDMwNS45NTY1NzEgNjUzLjYwNDU3MWE0NS41NjggNDUuNTY4IDAgMSAwIDY0LjQzODg1OCA2NC40Mzg4NThMNTEyIDU3Ni41MTJsMTQxLjYwNDU3MSAxNDEuNTMxNDI5YTQ1LjU2OCA0NS41NjggMCAwIDAgNjQuNDM4ODU4LTY0LjQzODg1OEw1NzYuNTEyIDUxMmwxNDEuNTMxNDI5LTE0MS42MDQ1NzFhNDUuNTY4IDQ1LjU2OCAwIDEgMC02NC40Mzg4NTgtNjQuNDM4ODU4TDUxMiA0NDcuNDg4IDM3MC4zOTU0MjkgMzA1Ljk1NjU3MWE0NS41NjggNDUuNTY4IDAgMCAwLTY0LjQzODg1OCA2NC40Mzg4NTh6IiBmaWxsPSIjNGU4M2ZkIiBwLWlkPSI2MzY4Ij48L3BhdGg+PC9zdmc+" class="my-footer"></div><!--]--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/note/" aria-label="首页"><!--[--><!--[--><!--]--> 首页 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术文档"><span class="title">技术文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术文档"><span class="title">技术文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Stream%E6%B5%81%E5%BC%8F%E7%BC%96%E7%A8%8B.html" aria-label="Stream流式编程"><!--[--><!--[--><!--]--> Stream流式编程 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/IDEA%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7.html" aria-label="IDEA常用技巧"><!--[--><!--[--><!--]--> IDEA常用技巧 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/log%E6%97%A5%E5%BF%97%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D.html" aria-label="log日志快速定位"><!--[--><!--[--><!--]--> log日志快速定位 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" aria-label="linux常用命令"><!--[--><!--[--><!--]--> linux常用命令 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99.html" aria-label="常用工具网站"><!--[--><!--[--><!--]--> 常用工具网站 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>部署相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html" aria-label="frp内网穿透"><!--[--><!--[--><!--]--> frp内网穿透 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/minio%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8.html" aria-label="minio安装使用"><!--[--><!--[--><!--]--> minio安装使用 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/yarn2.0_%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85.html" aria-label="yarn2.0+版本安装"><!--[--><!--[--><!--]--> yarn2.0+版本安装 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/Windows%E7%B3%BB%E7%BB%9F%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1.html" aria-label="Windows系统后台运行服务"><!--[--><!--[--><!--]--> Windows系统后台运行服务 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link route-link-active" href="/note/docs/knowledgeShard/" aria-label="知识碎片"><!--[--><!--[--><!--]--> 知识碎片 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/note/docs/readNote/" aria-label="阅读笔记"><!--[--><!--[--><!--]--> 阅读笔记 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="公考资料"><span class="title">公考资料</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="公考资料"><span class="title">公考资料</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>公基</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%93%B2%E5%AD%A6.html" aria-label="哲学"><!--[--><!--[--><!--]--> 哲学 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E4%B8%AD%E5%85%B1%E5%85%9A%E5%8F%B2.html" aria-label="中共党史"><!--[--><!--[--><!--]--> 中共党史 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%AE%AA%E6%B3%95.html" aria-label="宪法"><!--[--><!--[--><!--]--> 宪法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%88%91%E6%B3%95.html" aria-label="刑法"><!--[--><!--[--><!--]--> 刑法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E6%B0%91%E6%B3%95.html" aria-label="民法"><!--[--><!--[--><!--]--> 民法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E8%A1%8C%E6%94%BF%E6%B3%95.html" aria-label="行政法"><!--[--><!--[--><!--]--> 行政法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%85%AC%E5%8A%A1%E5%91%98%E6%B3%95.html" aria-label="公务员法"><!--[--><!--[--><!--]--> 公务员法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E7%BB%8F%E6%B5%8E.html" aria-label="经济"><!--[--><!--[--><!--]--> 经济 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%85%AC%E6%96%87%E7%9F%A5%E8%AF%86.html" aria-label="公文知识"><!--[--><!--[--><!--]--> 公文知识 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>行测</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E8%A1%8C%E6%B5%8B/%E5%88%A4%E6%96%AD.html" aria-label="判断"><!--[--><!--[--><!--]--> 判断 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://czxcab.cn/message" rel="noopener noreferrer" target="_blank" aria-label="留言板"><!--[--><!--[--><!--]--> 留言板 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenzhexian" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/chenzhexian" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><a class="route-link" href="/note/" aria-label="首页"><!--[--><!--[--><!--]--> 首页 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术文档"><span class="title">技术文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术文档"><span class="title">技术文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>常用工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Stream%E6%B5%81%E5%BC%8F%E7%BC%96%E7%A8%8B.html" aria-label="Stream流式编程"><!--[--><!--[--><!--]--> Stream流式编程 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/IDEA%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7.html" aria-label="IDEA常用技巧"><!--[--><!--[--><!--]--> IDEA常用技巧 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/log%E6%97%A5%E5%BF%97%E5%BF%AB%E9%80%9F%E5%AE%9A%E4%BD%8D.html" aria-label="log日志快速定位"><!--[--><!--[--><!--]--> log日志快速定位 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4.html" aria-label="linux常用命令"><!--[--><!--[--><!--]--> linux常用命令 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E7%BD%91%E7%AB%99.html" aria-label="常用工具网站"><!--[--><!--[--><!--]--> 常用工具网站 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>部署相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.html" aria-label="frp内网穿透"><!--[--><!--[--><!--]--> frp内网穿透 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/minio%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8.html" aria-label="minio安装使用"><!--[--><!--[--><!--]--> minio安装使用 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/yarn2.0_%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85.html" aria-label="yarn2.0+版本安装"><!--[--><!--[--><!--]--> yarn2.0+版本安装 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/technicalDocument/%E9%83%A8%E7%BD%B2%E7%9B%B8%E5%85%B3/Windows%E7%B3%BB%E7%BB%9F%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1.html" aria-label="Windows系统后台运行服务"><!--[--><!--[--><!--]--> Windows系统后台运行服务 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="route-link route-link-active" href="/note/docs/knowledgeShard/" aria-label="知识碎片"><!--[--><!--[--><!--]--> 知识碎片 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="route-link" href="/note/docs/readNote/" aria-label="阅读笔记"><!--[--><!--[--><!--]--> 阅读笔记 <!--[--><!--]--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="公考资料"><span class="title">公考资料</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="公考资料"><span class="title">公考资料</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>公基</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%93%B2%E5%AD%A6.html" aria-label="哲学"><!--[--><!--[--><!--]--> 哲学 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E4%B8%AD%E5%85%B1%E5%85%9A%E5%8F%B2.html" aria-label="中共党史"><!--[--><!--[--><!--]--> 中共党史 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%AE%AA%E6%B3%95.html" aria-label="宪法"><!--[--><!--[--><!--]--> 宪法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%88%91%E6%B3%95.html" aria-label="刑法"><!--[--><!--[--><!--]--> 刑法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E6%B0%91%E6%B3%95.html" aria-label="民法"><!--[--><!--[--><!--]--> 民法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E8%A1%8C%E6%94%BF%E6%B3%95.html" aria-label="行政法"><!--[--><!--[--><!--]--> 行政法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%85%AC%E5%8A%A1%E5%91%98%E6%B3%95.html" aria-label="公务员法"><!--[--><!--[--><!--]--> 公务员法 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E7%BB%8F%E6%B5%8E.html" aria-label="经济"><!--[--><!--[--><!--]--> 经济 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E5%85%AC%E5%9F%BA/%E5%85%AC%E6%96%87%E7%9F%A5%E8%AF%86.html" aria-label="公文知识"><!--[--><!--[--><!--]--> 公文知识 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>行测</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a class="route-link" href="/note/docs/shangan/%E8%A1%8C%E6%B5%8B/%E5%88%A4%E6%96%AD.html" aria-label="判断"><!--[--><!--[--><!--]--> 判断 <!--[--><!--]--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://czxcab.cn/message" rel="noopener noreferrer" target="_blank" aria-label="留言板"><!--[--><!--[--><!--]--> 留言板 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Chenzhexian" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/chenzhexian" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">知识碎片 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link route-link-active sidebar-item" href="/note/docs/knowledgeShard/" aria-label="介绍"><!--[--><!--[--><!--]--> 介绍 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/Bean%E6%8B%B7%E8%B4%9D%E4%B9%8BMapStruct.html" aria-label="MapStruct"><!--[--><!--[--><!--]--> MapStruct <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/EasyExcel%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6.html" aria-label="EasyExcel导出文件"><!--[--><!--[--><!--]--> EasyExcel导出文件 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/LocalDateTime%E7%9A%84%E4%BD%BF%E7%94%A8.html" aria-label="LocalDateTime的使用"><!--[--><!--[--><!--]--> LocalDateTime的使用 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/Git%20%E6%8F%90%E4%BA%A4%E7%AB%9F%E7%84%B6%E8%BF%98%E8%83%BD%E8%BF%99%E4%B9%88%E7%94%A8%EF%BC%9F.html" aria-label="Git提交"><!--[--><!--[--><!--]--> Git提交 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/%E5%90%8E%E7%AB%AF%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%9F.html" aria-label="单元测试"><!--[--><!--[--><!--]--> 单元测试 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F.html" aria-label="数据库备份还原"><!--[--><!--[--><!--]--> 数据库备份还原 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/mysqlbinlog%E7%9A%84%E4%BD%BF%E7%94%A8.html" aria-label="mysqlbinlog的使用"><!--[--><!--[--><!--]--> mysqlbinlog的使用 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active sidebar-item active" href="/note/docs/knowledgeShard/mybatisplus%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E5%85%A5%E5%99%A8.html" aria-label="mybatisplus自定义注入器"><!--[--><!--[--><!--]--> mybatisplus自定义注入器 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#问题与现状" aria-label="问题与现状"><!--[--><!--[--><!--]--> 问题与现状 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#解决方法实现" aria-label="解决方法实现"><!--[--><!--[--><!--]--> 解决方法实现 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#自定义注入器" aria-label="自定义注入器"><!--[--><!--[--><!--]--> 自定义注入器 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#自定义方法" aria-label="自定义方法"><!--[--><!--[--><!--]--> 自定义方法 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#自定义mapper和serviceimpl" aria-label="自定义Mapper和ServiceImpl"><!--[--><!--[--><!--]--> 自定义Mapper和ServiceImpl <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#如何使用" aria-label="如何使用"><!--[--><!--[--><!--]--> 如何使用 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="#源码解析" aria-label="源码解析"><!--[--><!--[--><!--]--> 源码解析 <!--[--><!--]--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#sql是如何注入的" aria-label="SQL是如何注入的？"><!--[--><!--[--><!--]--> SQL是如何注入的？ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#方法注入" aria-label="方法注入"><!--[--><!--[--><!--]--> 方法注入 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#sql语句是怎么生成的" aria-label="SQL语句是怎么生成的？"><!--[--><!--[--><!--]--> SQL语句是怎么生成的？ <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#mapper文件被添加的过程" aria-label="Mapper文件被添加的过程"><!--[--><!--[--><!--]--> Mapper文件被添加的过程 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#mp入口" aria-label="MP入口"><!--[--><!--[--><!--]--> MP入口 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#mybatissqlsessionfactorybean" aria-label="MybatisSqlSessionFactoryBean"><!--[--><!--[--><!--]--> MybatisSqlSessionFactoryBean <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#buildsqlsessionfactory" aria-label="buildSqlSessionFactory"><!--[--><!--[--><!--]--> buildSqlSessionFactory <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/%E4%B8%80%E7%AF%87%E6%90%9E%E5%AE%9Amaven.html" aria-label="一篇搞定maven"><!--[--><!--[--><!--]--> 一篇搞定maven <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/%E8%BD%BB%E6%9D%BE%E6%90%9E%E5%AE%9ASQL%E8%B0%83%E4%BC%98.html" aria-label="轻松搞定SQL调优"><!--[--><!--[--><!--]--> 轻松搞定SQL调优 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8F%8A%E5%BA%94%E7%94%A8.html" aria-label="设计模式及应用"><!--[--><!--[--><!--]--> 设计模式及应用 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="/note/docs/knowledgeShard/SpringSecurity%E6%95%B4%E5%90%88SAS.html" aria-label="SpringSecurity整合SAS"><!--[--><!--[--><!--]--> SpringSecurity整合SAS <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="mybatisplus自定义注入器" tabindex="-1"><a class="header-anchor" href="#mybatisplus自定义注入器"><span>mybatisplus自定义注入器</span></a></h1><h2 id="问题与现状" tabindex="-1"><a class="header-anchor" href="#问题与现状"><span>问题与现状</span></a></h2><p>工作中在进行erp相关功能的开发及其他用到sqlserver数据库的时候，使用系统框架mybatisplus的querywrapper写法生成的sql无法自动添加 with (nolock)，这可能产生锁表问题。</p><p>那如何解决这个问题，最简单的方法就是手写sql，那我们都用mybatisplus了肯定不再愿意手写那些sql语句，所以这里用到了mybatisplus提供的注入器</p><h2 id="解决方法实现" tabindex="-1"><a class="header-anchor" href="#解决方法实现"><span>解决方法实现</span></a></h2><div class="custom-container tip"><p class="custom-container-title">我们先讲一下怎么实现的再来解析源码</p></div><h3 id="自定义注入器" tabindex="-1"><a class="header-anchor" href="#自定义注入器"><span>自定义注入器</span></a></h3><p>首先我们创建一个类<code>NolockInjector</code>，并让这个类继承<code>DefaultSqlInjector</code>这个类，然后我们要重写<code>getMethodList()</code>这个方法</p><p><img src="https://czxcab.cn/file/docs/mp1.jpg" alt=""></p><p>result列表中添加的，比如<code>SelectListNolock()</code>就是我们自定义的方法类</p><h3 id="自定义方法" tabindex="-1"><a class="header-anchor" href="#自定义方法"><span>自定义方法</span></a></h3><p>创建一个类<code>SelectListNolock</code>，并继承<code>AbstractMethod</code>这个类，然后重写<code>injectMappedStatement()</code>这个方法，具体怎么写这个方法让它能生成我们想要的sql，等下面具体说明</p><p><img src="https://czxcab.cn/file/docs/mp2.jpg" alt=""></p><h3 id="自定义mapper和serviceimpl" tabindex="-1"><a class="header-anchor" href="#自定义mapper和serviceimpl"><span>自定义Mapper和ServiceImpl</span></a></h3><p>创建一个<code>SqlserverNolockBaseMapper</code>接口和一个<code>SqlServerNolockServiceImpl</code>类，然后将上面自定义的方法写在里面</p><p>SqlserverNolockBaseMapper：</p><p><img src="https://czxcab.cn/file/docs/mp3.jpg" alt=""></p><p>SqlserverNolockBaseMapper：</p><p><img src="https://czxcab.cn/file/docs/mp4.jpg" alt=""></p><h3 id="如何使用" tabindex="-1"><a class="header-anchor" href="#如何使用"><span>如何使用</span></a></h3><p>平时代码中mapper都会继承<code>BaseMapper</code>接口</p><p><img src="https://czxcab.cn/file/docs/mp6.jpg" alt=""></p><p>现在改为继承自定义的<code>SqlserverNolockBaseMapper</code></p><p><img src="https://czxcab.cn/file/docs/mp5.jpg" alt=""></p><p>平时代码中Service都会继承<code>ServiceImpl</code>这个类</p><p><img src="https://czxcab.cn/file/docs/mp7.jpg" alt=""></p><p>现在改为继承自定义的<code>SqlServerNolockServiceImpl</code></p><p><img src="https://czxcab.cn/file/docs/mp8.jpg" alt=""></p><p>然后就能在代码中调用我们自定义的方法了</p><p><img src="https://czxcab.cn/file/docs/mp9.jpg" alt=""></p><h2 id="源码解析" tabindex="-1"><a class="header-anchor" href="#源码解析"><span>源码解析</span></a></h2><h3 id="sql是如何注入的" tabindex="-1"><a class="header-anchor" href="#sql是如何注入的"><span>SQL是如何注入的？</span></a></h3><p>那么SQL到底是如何注入的呢？我们先来看我们继承的SQL注入器，也是mybatisplus默认使用的注入器<code>DefaultSqlInjector</code>，查看一下它的UML图，我们能发现它的最顶层是<code>ISqlInjector</code>接口</p><p><img src="https://czxcab.cn/file/docs/mp10.jpg" alt=""></p><p>进入<code>ISqlInjector</code>接口，我们可以看到一个方法<code>inspectInject()</code>，那么这个接口到底是干嘛用的呢？它只做一件事，那就是检查SQL是否注入，已经注入过则不再注入。</p><p><img src="https://czxcab.cn/file/docs/mp11.jpg" alt=""></p><p>继续往下走，看下一层抽象类<code>AbstractSqlInjector</code>，一共有两个方法。一个是重写后的<code>inspectInject()</code>方法，另一个是<code>inspectInject()</code>方法中调用到的抽象方法<code>getMethodList()</code></p><p><img src="https://czxcab.cn/file/docs/mp12.jpg" alt=""></p><p>我们先来看看<code>getMethodList()</code>方法，可以发现这个方法就是我们自定义注入器所重写的方法，那我们再进入<code>DefaultSqlInjector</code>看一下这个方法做了什么，</p><p><img src="https://czxcab.cn/file/docs/mp13.jpg" alt=""></p><p>从代码可以很清晰的看出，<code>DefaultSqlInjector</code>在这里将MP默认实现的CRUD方法进行注入。</p><p>上面说了一堆，但是我相信你还是没懂，不如一起debug来看看：这里主要看下数据库信息的获取以及方法的注入。</p><p>我们在<code>AbstractSqlInjector</code>中的<code>inspectInject()</code>方法中打个断点，首先我们可以看到<code>TableInfoHelper.initTableInfo()</code>方法获取到了数据库表的相关信息，那么它是如何做到的呢？我们进入刚方法内查看</p><p><img src="https://czxcab.cn/file/docs/mp14.jpg" alt=""></p><p>通过查看代码，我们可以看到初始化数据库信息的方法主要为<code>initTableName()</code>以及<code>initTableFields()</code></p><p><img src="https://czxcab.cn/file/docs/mp15.jpg" alt=""></p><p><code>initTableName()</code>的作用是获取表名信息，主要通过实体上的<code>@TableName</code>注解拿到表名，所以我们这里拿到了表名。</p><p><img src="https://czxcab.cn/file/docs/mp16.jpg" alt=""></p><p><code>initTableFields()</code>的作用主要为获取主键及其他字段信息，至此，数据库信息则获取成功，可供注入SQL方法时使用。</p><p><img src="https://czxcab.cn/file/docs/mp17.jpg" alt=""></p><h3 id="方法注入" tabindex="-1"><a class="header-anchor" href="#方法注入"><span>方法注入</span></a></h3><p>获取完表信息后，可以发现通过<code>getMethodList()</code>方法获取了所有自定义方法，这些方法都是哪里来的呢？都是从<code>AbstractSqlInjector</code>抽象类的子类中获取的，比如默认的SQL注入器<code>DefaultSqlInjector</code>以及我们自定的Inject。</p><p><img src="https://czxcab.cn/file/docs/mp18.jpg" alt=""></p><p>获取所有自定义方法后，可以发现通过调用<code>AbstractMethod</code>的<code>inject()</code>方法实现了SQL的自动注入，这里也把上文获取到的数据库表对象传入用来进行SQL的封装。</p><p><img src="https://czxcab.cn/file/docs/mp19.jpg" alt=""></p><p>可以看到<code>injectMappedStatement()</code>方法就是我们自定义方法中所重写的，根据自己的需求重写方法，最后将生成好的<code>MappedStatement</code>对象加入到全局配置类对象中。</p><p><img src="https://czxcab.cn/file/docs/mp20.jpg" alt=""></p><h3 id="sql语句是怎么生成的" tabindex="-1"><a class="header-anchor" href="#sql语句是怎么生成的"><span>SQL语句是怎么生成的？</span></a></h3><h4 id="abstractmethod" tabindex="-1"><a class="header-anchor" href="#abstractmethod"><span>AbstractMethod</span></a></h4><p>上面了解了SQL是如何注入后，我们再来看下SQL是怎么生成的。我们直接看<code>DefaultSqlInjector</code>提供的默认方法，可以发现所有的方法都继承了<code>AbstractMethod</code>。该类主要用于封装Mapper接口中定义的方法信息，并提供了一些默认实现。通过继承<code>AbstractMethod</code>类并重写其中的方法，我们可以自定义生成 SQL 语句的方式，从而实现更加灵活的 SQL 操作。</p><p>该类我们目前只需要关注<code>inject()</code>方法，它主要通过<code>injectMappedStatement()</code>方法实现了自动注入SQL的动作。<code>injectMappedStatement()</code>是一个模板方法，每个自定义SQL类都可以对其进行重写，然后将封装好的sql存放到全局配置文件类中。</p><p>这里我们以<code>SelectById</code>类作为案例来对其分析。</p><p>首先可以看到在构造方法中将<code>SqlMethod</code>枚举类中定义好的方法名传入到父类中，方便后续使用；同时重写<code>injectMappedStatement()</code>方法，通过SQL模板构建出SQL语句并存入到全局配置类中。</p><p><img src="https://czxcab.cn/file/docs/mp21.jpg" alt=""></p><h4 id="sqlmethod" tabindex="-1"><a class="header-anchor" href="#sqlmethod"><span>SqlMethod</span></a></h4><p><img src="https://czxcab.cn/file/docs/mp22.jpg" alt=""></p><p><code>SqlMethod</code>就是一个枚举类，存储了两个关键的元素：</p><ul><li><code>BaseMapper</code>中的方法名</li><li>方法名对应的sql语句模板 看到这两个元素，相信大家应该已经知道SQL自动生成的本质了：根据不同的方法来提供一些通用的模板，项目启动后再将其加载进<code>mappedStatement</code>。</li></ul><h4 id="sqlsource" tabindex="-1"><a class="header-anchor" href="#sqlsource"><span>SqlSource</span></a></h4><p><code>SqlSource</code>对象里面则是通过解析SQL模板、以及传入的表信息和主键信息构建出了一条SQL语句：</p><p><img src="https://czxcab.cn/file/docs/mp23.jpg" alt=""></p><p>可能会有人疑惑这里的表信息是从何而来，其实这些表信息就是在SQL注入的时候获取的表信息，然后传到<code>AbstractMethod</code>中的，所以在重写<code>injectMappedStatement()</code>方法的时候就可以使用到了。</p><p><img src="https://czxcab.cn/file/docs/mp24.jpg" alt=""></p><h3 id="mapper文件被添加的过程" tabindex="-1"><a class="header-anchor" href="#mapper文件被添加的过程"><span>Mapper文件被添加的过程</span></a></h3><p>看完上述内容相信大家应该都知道了SQL注入器的基本原理了，那么SQL注入器是在哪里添加到Mybatis中的呢？如果不太清楚的话，我们带着问题往下看。</p><p>首先我们回顾下Mybatis 的执行流程，一般可以分为以下几个步骤：</p><ol><li>加载配置文件：在应用启动时，Mybatis 会读取配置文件<code>mybatis-config.xml</code>并解析其中的配置信息，例如数据库连接信息、映射器信息等。</li><li>创建 <code>SqlSessionFactory</code>：通过<code>SqlSessionFactoryBuilder</code> 类加载配置文件中的信息，并创建 <code>SqlSessionFactory</code> 对象。<code>SqlSessionFactory</code> 是一个重量级的对象，它的作用是创建 <code>SqlSession</code> 对象，<code>SqlSession</code> 是用于执行 SQL 语句的核心对象。</li><li>创建 <code>SqlSession</code>：通过 <code>SqlSessionFactory</code> 的 <code>openSession</code> 方法创建 <code>SqlSession</code> 对象。在执行 SQL 操作时，我们需要通过 SqlSession 对象获取到对应的 Mapper 接口，然后调用该接口中定义的方法来执行 SQL 语句。</li><li>获取 <code>Mapper</code> 接口：在 Mybatis 中，我们通常通过 <code>Mapper</code> 接口的方式执行 SQL 操作。因此，在获取 <code>Mapper</code> 接口之前，我们需要先配置映射关系，即在配置文件中指定 <code>Mapper</code> 接口所对应的 XML 文件或注解类。在创建 <code>SqlSession</code> 对象后，我们可以通过 <code>SqlSession</code> 的 <code>getMapper</code> 方法获取到对应的 <code>Mapper</code> 接口。</li><li>执行 SQL 语句：当我们获取到 <code>Mapper</code> 接口后，就可以通过调用其方法执行 SQL 语句了。在执行 SQL 语句前，Mybatis 会将 <code>Mapper</code> 接口中定义的 SQL 语句转换成 <code>MappedStatement</code> 对象，并将其中的参数信息传递给 <code>Executor</code> 对象执行 SQL 语句。</li><li>处理 SQL 语句的执行结果：在执行 SQL 语句后，Mybatis 会将查询结果封装成对应的 Java 对象并返回。</li></ol><p><img src="https://czxcab.cn/file/docs/mp25.jpg" alt=""></p><h3 id="mp入口" tabindex="-1"><a class="header-anchor" href="#mp入口"><span>MP入口</span></a></h3><p>可能有些人不知道MP的具体入口从哪里看，其实很简单，我们可以直接去<code>mybatis-plus-boot-starter</code>中<code>resources</code>下的<code>META-INF</code>文件夹下查看：</p><p><img src="https://czxcab.cn/file/docs/mp26.jpg" alt=""></p><p>可以看到配置的自动启动类是<code>MybatisPlusAutoConfiguration</code>；</p><p>这个类由于实现了<code>InitializingBean</code>接口，得到了<code>afterPropertiesSet</code>方法，在Bean初始化后，会自动调用。 还有三个标注了 <code>@ConditionalOnMissingBean</code> 注解的方法，说明这些方法在没有配置对应对象时会由SpringBoot创建Bean，并且保存到容器中。</p><p>所以<code>sqlSessionFactory</code>方法在没有配置<code>SqlSessionFactory</code>时会由SpringBoot创建Bean，并且保存到容器中。</p><h3 id="mybatissqlsessionfactorybean" tabindex="-1"><a class="header-anchor" href="#mybatissqlsessionfactorybean"><span>MybatisSqlSessionFactoryBean</span></a></h3><p>我们可以发现进入<code>sqlSessionFactory</code>方法后就会实例化<code>MybatisSqlSessionFactoryBean</code>类，那么该类到底做了什么呢？</p><p><img src="https://czxcab.cn/file/docs/mp27.jpg" alt=""></p><p>可以发现该类实现了三个接口<code>FactoryBean&lt;SqlSessionFactory&gt;</code>, <code>InitializingBean</code>, <code>ApplicationListener&lt;ApplicationEvent&gt;</code>：</p><ol><li><p><code>FactoryBean</code>：说明用到了工厂模式</p></li><li><p><code>InitializingBean</code>：<code>afterPropertiesSet</code> 在属性设置完成时调用（在Bean创建完成时）调用</p></li><li><p><code>ApplicationListener</code>是一个监听器，监听的是<code>ApplicationContext</code>初始化或者刷新事件，当初始化或者刷新时调用。</p></li></ol><p>这里我们主要看初始化后调用的方法<code>afterPropertiesSet</code>：可以发现在该方法中调用了<code>buildSqlSessionFactory</code>方法。</p><p><img src="https://czxcab.cn/file/docs/mp28.jpg" alt=""></p><h3 id="buildsqlsessionfactory" tabindex="-1"><a class="header-anchor" href="#buildsqlsessionfactory"><span>buildSqlSessionFactory</span></a></h3><p>那么<code>buildSqlSessionFactory</code>方法做了些什么呢？简单的说就是创建一个<code>SqlSessionFactory</code>实例，虽然里面还有很多其他步骤，但是不在本文谈论范围内。</p><p>我们直接看最重要的部分<code>xmlMapperBuilder.parse()</code>：</p><p><img src="https://czxcab.cn/file/docs/mp29.jpg" alt=""></p><p><code>parse</code>方法主要用来解析xml文件，<code>bindMapperForNamespace</code>方法则用来解析接口文件。</p><p><img src="https://czxcab.cn/file/docs/mp30.jpg" alt=""></p><p><code>addMapper</code>方法是由前面<code>MybatisConfiguration</code>调用的。</p><p><img src="https://czxcab.cn/file/docs/mp31.jpg" alt=""></p><p>我们进入<code>MybatisConfiguration</code>这里会解析出对应的类型，然后内部调用<code>MybatisMapperRegistry</code>的方法：</p><p><img src="https://czxcab.cn/file/docs/mp32.jpg" alt=""></p><p>内部最后是由<code>MybatisMapperAnnotationBuilder</code>去解析的：</p><p><img src="https://czxcab.cn/file/docs/mp33.jpg" alt=""></p><p>可以发现最后又回到了我们最初说到的<code>AbstractSqlInjector</code>类中的<code>inspectInject</code>方法，该类帮助我们实现了基本SQL方法的自动注入。</p><p><img src="https://czxcab.cn/file/docs/mp34.jpg" alt=""></p><p>到这里相信大家已经对SQL注入器的原理有了一个清楚的认识了，如果还不太理解的话，可以从MP入口处开始，根据截图的内容自行打断点熟悉下。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 2504058202@qq.com">czx</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link prev" href="/note/docs/knowledgeShard/mysqlbinlog%E7%9A%84%E4%BD%BF%E7%94%A8.html" aria-label="mysqlbinlog的使用"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>mysqlbinlog的使用</span></div><!--]--></a><a class="route-link next" href="/note/docs/knowledgeShard/%E4%B8%80%E7%AF%87%E6%90%9E%E5%AE%9Amaven.html" aria-label="一篇搞定maven"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>一篇搞定maven</span></div><!--]--></a></nav><!--[--><!--[--><div class="gitalk-container"><div id="gitalk-container"></div></div><!--]--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/note/assets/app-BoIshBAq.js" defer></script>
  </body>
</html>
